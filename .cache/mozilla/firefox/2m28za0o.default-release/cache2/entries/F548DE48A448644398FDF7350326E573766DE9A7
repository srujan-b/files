"use strict";(self.webpackChunkhusarnet_docs=self.webpackChunkhusarnet_docs||[]).push([[9629],{3905:(e,n,a)=>{a.d(n,{Zo:()=>m,kt:()=>_});var t=a(67294);function o(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function r(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function l(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?r(Object(a),!0).forEach((function(n){o(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function i(e,n){if(null==e)return{};var a,t,o=function(e,n){if(null==e)return{};var a,t,o={},r=Object.keys(e);for(t=0;t<r.length;t++)a=r[t],n.indexOf(a)>=0||(o[a]=e[a]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(t=0;t<r.length;t++)a=r[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=t.createContext({}),p=function(e){var n=t.useContext(s),a=n;return e&&(a="function"==typeof e?e(n):l(l({},n),e)),a},m=function(e){var n=p(e.components);return t.createElement(s.Provider,{value:n},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},u=t.forwardRef((function(e,n){var a=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,m=i(e,["components","mdxType","originalType","parentName"]),c=p(a),u=o,_=c["".concat(s,".").concat(u)]||c[u]||d[u]||r;return a?t.createElement(_,l(l({ref:n},m),{},{components:a})):t.createElement(_,l({ref:n},m))}));function _(e,n){var a=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var r=a.length,l=new Array(r);l[0]=u;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i[c]="string"==typeof e?e:o,l[1]=i;for(var p=2;p<r;p++)l[p]=a[p];return t.createElement.apply(null,l)}return t.createElement.apply(null,a)}u.displayName="MDXCreateElement"},72605:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>p,contentTitle:()=>i,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>m});var t=a(87462),o=(a(67294),a(3905)),r=a(10777);const l={sidebar_label:"Security guard robot",id:"security-guard-robot",title:"Security guard robot using YOLO and Wi-Fi sensor network"},i=void 0,s={unversionedId:"ros-projects/security-guard-robot",id:"ros-projects/security-guard-robot",title:"Security guard robot using YOLO and Wi-Fi sensor network",description:"Introduction",source:"@site/docs/tutorials/ros-projects/security-guard-robot.md",sourceDirName:"ros-projects",slug:"/ros-projects/security-guard-robot",permalink:"/tutorials/ros-projects/security-guard-robot",draft:!1,tags:[],version:"current",frontMatter:{sidebar_label:"Security guard robot",id:"security-guard-robot",title:"Security guard robot using YOLO and Wi-Fi sensor network"},sidebar:"tutorialsSidebar",previous:{title:"9. Exploration",permalink:"/tutorials/ros-tutorials/9-exploration"},next:{title:"Control virtual robot from your PC",permalink:"/tutorials/ros-projects/control-virtual-robot-from-your-PC"}},p={},m=[{value:"Introduction",id:"introduction",level:2},{value:"Run on virtual environment",id:"run-on-virtual-environment",level:2},{value:"Preparation",id:"preparation",level:2},{value:"Starting project step by step",id:"starting-project-step-by-step",level:2},{value:"What to install",id:"what-to-install",level:3},{value:"Create your packages",id:"create-your-packages",level:3},{value:"Simulation part",id:"simulation-part",level:2},{value:"Save map",id:"save-map",level:3},{value:"AMCL",id:"amcl",level:3},{value:"Final launch for world",id:"final-launch-for-world",level:2},{value:"Main code",id:"main-code",level:2},{value:"Our custom message for esp",id:"our-custom-message-for-esp",level:3},{value:"Class files",id:"class-files",level:3},{value:"Main file",id:"main-file",level:3},{value:"CMakeLists and package",id:"cmakelists-and-package",level:2},{value:"Create room points",id:"create-room-points",level:2},{value:"Yolo setup",id:"yolo-setup",level:2},{value:"Test this algorithm",id:"test-this-algorithm",level:2},{value:"Real robot part",id:"real-robot-part",level:2},{value:"Introduction",id:"introduction-1",level:2},{value:"Main code",id:"main-code-1",level:2},{value:"Include",id:"include",level:3},{value:"Src",id:"src",level:3},{value:"Hardware launches",id:"hardware-launches",level:2},{value:"Now we need to focus about algorithm.",id:"now-we-need-to-focus-about-algorithm",level:2},{value:"Move base",id:"move-base",level:3},{value:"AMCL",id:"amcl-1",level:3},{value:"Gmapping",id:"gmapping",level:3},{value:"Find coordinates for move sensor",id:"find-coordinates-for-move-sensor",level:3},{value:"Setup ESP32",id:"setup-esp32",level:2},{value:"CMakeList and package",id:"cmakelist-and-package",level:2},{value:"Darknet YOLO",id:"darknet-yolo",level:2},{value:"Final launch files",id:"final-launch-files",level:2},{value:"Complete code",id:"complete-code",level:3},{value:"Finishing",id:"finishing",level:2},{value:"rosbot_final_result",id:"rosbot_final_result",level:2}],c=(d="Downloads",function(e){return console.warn("Component "+d+" was not imported, exported, or provided by MDXProvider as global scope"),(0,o.kt)("div",e)});var d;const u={toc:m},_="wrapper";function h(e){let{components:n,...l}=e;return(0,o.kt)(_,(0,t.Z)({},u,l,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"introduction"},"Introduction"),(0,o.kt)("p",null,"Patrol area is a task for robot defined in 4 points."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Having information about plausible threats"),(0,o.kt)("li",{parentName:"ol"},"Checking area by robot"),(0,o.kt)("li",{parentName:"ol"},"Classifying threads"),(0,o.kt)("li",{parentName:"ol"},"Informing owner when it's real threat")),(0,o.kt)("p",null,"This project is focused on maintaining your house/office secure when no one is inside and provide that by following rosbot task.\nWe will use rosbot platform with astra camera, ESP-32 microchips with motion sensor (RPI HC-SR501) and external computer taking care of image processing."),(0,o.kt)("p",null,"Because project covers many fields it will be shown and explained how to configure everything properly. Project was also devided into simulation part and real robot part, this should give a clear view about whole project."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"rosbot_how_it_works",src:a(51879).Z,width:"671",height:"471"})),(0,o.kt)("h2",{id:"run-on-virtual-environment"},"Run on virtual environment"),(0,o.kt)("p",null,"NOTE: You can run the following project in a virtual environment and get all the code and documentation by clicking on the ROSDS button"),(0,o.kt)("div",null,(0,o.kt)("center",null,(0,o.kt)("a",{href:"http://www.rosject.io/l/c104eda/"},(0,o.kt)("img",{alt:"run-on-ROSDS",src:r.Z,width:"250px"})))),(0,o.kt)("h2",{id:"preparation"},"Preparation"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"It is assumed that you have ros already installed - because rosbot currently works on ros melodic it's necessary to have this version, in case you don't have that check official docs : ",(0,o.kt)("a",{parentName:"li",href:"http://wiki.ros.org/melodic/Installation"},"ROS melodic installation")," ."),(0,o.kt)("li",{parentName:"ol"},"It is also assumed that you have your ros workspace configured with tutorial_pkg cloned to your workspace ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/husarion/tutorial_pkg"},"tutorial_pkg")," because some files from this repository will be used. In case you don't just go to your workspace this should be something like this cd <ros_workspace>/src , next step is to clone whole pkg:")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"git clone https://github.com/husarion/tutorial_pkg.git")),(0,o.kt)("p",null,"It is also necessary to have cloned rosbot description to do, so use this command:"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"git clone https://github.com/husarion/rosbot_description.git")),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"For image processing advice is to use nvidia card with CUDA enabled (It won't be shown how to do that because it's not the point)."),(0,o.kt)("li",{parentName:"ol"},"You can download complete package from github:")),(0,o.kt)("p",null,"a) simulation ",(0,o.kt)("inlineCode",{parentName:"p"},"git clone https://github.com/adamkrawczyk/rosbot_patrol_simulation.git")),(0,o.kt)("p",null,"b) real_robot ",(0,o.kt)("inlineCode",{parentName:"p"},"git clone https://github.com/adamkrawczyk/rosbot_patrol.git")),(0,o.kt)("h2",{id:"starting-project-step-by-step"},"Starting project step by step"),(0,o.kt)("h3",{id:"what-to-install"},"What to install"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Mailbox (setup this on robot also):",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"chose internet setup set remaining parts as default during installation and setup")))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo apt install postfix\nsudo service postfix reload \nsudo apt install mailutils\nsudo apt-get install sendmail\nsudo dpkg-reconfigure postfix\nsudo /etc/init.d/postfix reload\n")),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"yaml parser\nThis can be installed anywhere eg. ",(0,o.kt)(c,{mdxType:"Downloads"})," or in <ros_ws/src>. Go to desired directory and paste:    "),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"git clone https://github.com/jbeder/yaml-cpp.git\ncd yaml-cpp\nmkdir build\ncd build\ncmake ..\n")),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("a",{parentName:"p",href:"https://github.com/jbeder/yaml-cpp"},"yaml parser install")))),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"CNN (convolutional neural network) for image processing ",(0,o.kt)("em",{parentName:"p"},"darknet ros")," will be used (install this in ~/ros_workspace/src) "),(0,o.kt)("p",{parentName:"li"},"To make it download you have to follow this instruction:"),(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},"Setup your ssh key follow this instruction to do, so - ",(0,o.kt)("a",{parentName:"li",href:"https://confluence.atlassian.com/bitbucket/set-up-an-ssh-key-728138079.html"},"setup ssh key")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"git clone --recursive git@github.com:leggedrobotics/darknet_ros.git")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"cd ../")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"catkin_make -DCMAKE_BUILD_TYPE=Release"))),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("a",{parentName:"p",href:"https://github.com/leggedrobotics/darknet_ros"},"darknet ros github"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Install this packages on rosbot and on computer (if you are going to use it to this project)",(0,o.kt)("br",{parentName:"p"}),"\n",(0,o.kt)("inlineCode",{parentName:"p"},"sudo apt install ros-melodic-grid-map*")))),(0,o.kt)("h3",{id:"create-your-packages"},"Create your packages"),(0,o.kt)("p",null,"Go to your workspace it should be something like:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"cd ~/ros_workspace/src\n")),(0,o.kt)("p",null,"Now create pkgs"),(0,o.kt)("p",null,"For simulation:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"catkin_create_pkg rosbot_patrol_simulation roscpp\n")),(0,o.kt)("p",null,"For real robot:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"catkin_create_pkg rosbot_patrol roscpp\n")),(0,o.kt)("p",null,"It is highly recommended to use this names because it will not be necessary to change names in almost every following file."),(0,o.kt)("h2",{id:"simulation-part"},"Simulation part"),(0,o.kt)("p",null,"For the first make whole simulation then test guard algorithm and finally implement that to real robot. Let's get this project rolling!"),(0,o.kt)("p",null,"Go to your pkg"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"cd rosbot_patrol_simulation\n")),(0,o.kt)("p",null,"World model is already prepared, so you have to download that. Let's prepare file for that."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"mkdir worlds\ncd worlds\ntouch model.world\n")),(0,o.kt)("p",null,"Then copy whole data inside this file from repository file, in directory named worlds there is file named model.world copy that and paste to model.world file."),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/adamkrawczyk/rosbot_patrol_simulation/tree/master/worlds"},"model world")," - enough is just copy whole file and paste in your repository"),(0,o.kt)("p",null,"In case you have never made any of ros_tutorials from husarion website here is whole package - just clone it to workspace ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/husarion/tutorial_pkg"},"tutorial_pkg")),(0,o.kt)("p",null,"After that first launch file for our robot - gmapping can be created."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"roscd rosbot_patrol_simulation\nmkdir launch\ncd launch\ntouch gmapping_only.launch\n")),(0,o.kt)("p",null,"Then open that file with your favorite editor and paste following code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},'<launch>\n\n  <node pkg="gmapping" type="slam_gmapping" name="slam_gmapping" output="screen">\n    <remap from="/base_scan" to="/scan"/>\n\n    <param name="base_frame" value="base_link"/>\n    <param name="map_frame" value="map"/>\n    <param name="odom_frame" value="odom"/>\n\n    <param name="map_update_interval" value="5.0"/>\n    <param name="maxUrange" value="16.0"/>\n    <param name="sigma" value="0.05"/>\n    <param name="kernelSize" value="1"/>\n    <param name="lstep" value="0.05"/>\n    <param name="astep" value="0.05"/>\n    <param name="iterations" value="5"/>\n    <param name="lsigma" value="0.075"/>\n    <param name="ogain" value="3.0"/>\n    <param name="lskip" value="0"/>\n    <param name="srr" value="0.1"/>\n    <param name="srt" value="0.2"/>\n    <param name="str" value="0.1"/>\n    <param name="stt" value="0.2"/>\n    <param name="linearUpdate" value="0.05"/>\n    <param name="angularUpdate" value="0.05"/>\n    <param name="temporalUpdate" value="0.5"/>\n    <param name="resampleThreshold" value="0.5"/>\n    <param name="particles" value="30"/>\n    <param name="xmin" value="-50.0"/>\n    <param name="ymin" value="-50.0"/>\n    <param name="xmax" value="50.0"/>\n    <param name="ymax" value="50.0"/>\n    <param name="delta" value="0.05"/>\n    <param name="llsamplerange" value="0.01"/>\n    <param name="llsamplestep" value="0.01"/>\n    <param name="lasamplerange" value="0.005"/>\n    <param name="lasamplestep" value="0.005"/>\n  </node>\n\n</launch>\n')),(0,o.kt)("p",null,"Make move_base launch, so type in console:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"touch move_base_only.launch\n")),(0,o.kt)("p",null,"Open this file and paste following code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},'<launch>\n\n    <node pkg="move_base" type="move_base" name="move_base" output="log">\n      <param name="controller_frequency" value="25.0"/>\n        <rosparam file="$(find tutorial_pkg)/config/costmap_common_params.yaml" command="load" ns="global_costmap" />\n        <rosparam file="$(find tutorial_pkg)/config/costmap_common_params.yaml" command="load" ns="local_costmap" />\n        <rosparam file="$(find tutorial_pkg)/config/local_costmap_params.yaml" command="load" />\n        <rosparam file="$(find tutorial_pkg)/config/trajectory_planner.yaml" command="load" />\n\n        <rosparam file="$(find rosbot_patrol_simulation)/config/global_costmap_params.yaml" command="load" />\n    </node>\n\n</launch>\n')),(0,o.kt)("p",null,"Notice that one file should be in rosbot_patrol_simulation pkg - it's required to create that file because slightly different params will be used."),(0,o.kt)("p",null,"To create this file follow instruction:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"roscd rosbot_patrol_simulation\ncd config\ntouch global_costmap_params.yaml\n")),(0,o.kt)("p",null,"In this file paste following code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"global_costmap:\n  update_frequency: 0.5\n  publish_frequency: 0.5\n  transform_tolerance: 0.5\n  width: 35\n  height: 35\n  static_map: false\n  rolling_window: true\n  inflation_radius: 2.5\n  resolution: 0.01\n")),(0,o.kt)("p",null,"It is no need to make rest of this files, they are in tutorial_pkg so you can copy them from tutorial_pkg or preferred way - have this pkg cloned to workspace. ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/husarion/tutorial_pkg"},"tutorial_pkg")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"roscd rosbot_patrol_simulation\nmkdir config\ncd config\n")),(0,o.kt)("p",null,"Here paste those files."),(0,o.kt)("p",null,"Then make simulation for robot"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"touch simulation_gmapping.launch\n")),(0,o.kt)("p",null,"Then open that file with your favorite editor and paste following code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},'<?xml version="1.0" encoding="UTF-8"?>\n<launch>\n    <param name="use_sim_time" value="true"/>\n    <arg name="world" default="empty"/>\n    <arg name="paused" default="false"/>\n    <arg name="use_sim_time" default="true"/>\n    <arg name="gui" default="true"/>\n    <arg name="headless" default="false"/>\n    <arg name="debug" default="false"/>\n\n    <include file="$(find gazebo_ros)/launch/empty_world.launch">\n        <arg name="world_name" value="$(find rosbot_patrol_simulation)/worlds/model.world"/>  \n    </include>\n    <include file="$(find rosbot_description)/launch/rosbot_gazebo.launch"/>\n    <include file="$(find rosbot_patrol_simulation)/launch/gmapping_only.launch" />  \n    <include file="$(find rosbot_patrol_simulation)/launch/move_base_only.launch" />    \n\n    <node pkg="tf" type="static_transform_publisher" name="laser_broadcaster" args="0 0 0 3.14 0 0 base_link laser_frame 100" />\n    <node name="teleop_twist_keyboard" pkg="teleop_twist_keyboard" type="teleop_twist_keyboard.py" output="screen"/>  \n    \n</launch>\n')),(0,o.kt)("p",null,"This launch gives ability to explore this world. To do that use following command"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"roslaunch rosbot_patrol_simulation simulation_gmapping.launch\n")),(0,o.kt)("p",null,"If only everything is configured properly there should be simulation of house-like world model.\nRobot should be able controllable from keyboard or from rviz setting goals.\nNext step is to map whole world, so drive rosbot to every room and check on rviz if everything is done correctly after that save map."),(0,o.kt)("h3",{id:"save-map"},"Save map"),(0,o.kt)("p",null,"Open another terminal and go to our project then in simulation make directory for maps."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"mkdir maps\ncd maps\n")),(0,o.kt)("p",null,"There map should be saved - do that with following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"rosrun map_server map_saver -f rosbot_map\n")),(0,o.kt)("p",null,"After that there should be map in folder maps"),(0,o.kt)("h3",{id:"amcl"},"AMCL"),(0,o.kt)("p",null,"Once the map is already saved we need to create launch for amcl to make the robot find it's location on that map.\nIn launch directory make new file called amcl_only.launch"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"roscd rosbot_patrol_simulation\ncd launch\ntouch amcl_only.launch\n")),(0,o.kt)("p",null,"Inside of this file paste following code, it's also in tutorial pkg :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},'<launch>\n    <node pkg="amcl" type="amcl" name="amcl" output="screen">\n    <remap from="scan" to="/scan"/>\n    <param name="odom_frame_id" value="odom"/>\n    <param name="odom_model_type" value="diff-corrected"/>\n    <param name="base_frame_id" value="base_link"/>\n    <param name="update_min_d" value="0.5"/>\n    <param name="update_min_a" value="1.0"/>\n    </node>   \n   \n</launch>\n')),(0,o.kt)("h2",{id:"final-launch-for-world"},"Final launch for world"),(0,o.kt)("p",null,"In launch directory create launch for whole world with map."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"roscd simulation\ncd launch\ntouch simulation_world.launch\n")),(0,o.kt)("p",null,"Inside of this file paste following code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},'<?xml version="1.0" encoding="UTF-8"?>\n<launch>\n    <param name="use_sim_time" value="true"/>\n    <arg name="world" default="empty"/>\n    <arg name="paused" default="false"/>\n    <arg name="use_sim_time" default="true"/>\n    <arg name="gui" default="true"/>\n    <arg name="headless" default="false"/>\n    <arg name="debug" default="false"/>\n\n    <include file="$(find gazebo_ros)/launch/empty_world.launch">\n      <arg name="world_name" value="$(find rosbot_patrol_simulation)/worlds/model.world"/>  \n    </include>\n    <include file="$(find rosbot_description)/launch/rosbot_gazebo.launch"/>\n    <include file="$(find rosbot_patrol_simulation)/launch/move_base_only.launch" />    \n    <include file="$(find rosbot_patrol_simulation)/launch/amcl_only.launch"/> \n\n    <node pkg="tf" type="static_transform_publisher" name="laser_broadcaster"   args="0 0 0 3.14 0 0 base_link laser_frame 100" />\n    <node name="teleop_twist_keyboard" pkg="teleop_twist_keyboard" type="teleop_twist_keyboard.py" output="screen"/>\n    \n    \x3c!--map server with simul map--\x3e\n    <arg name="map_file" default="$(find rosbot_patrol_simulation)/maps/rosbot_map.yaml"/>\n    <node name="map_server" pkg="map_server" type="map_server" args="$(arg map_file)" respawn="false" />\n\n</launch>\n')),(0,o.kt)("h2",{id:"main-code"},"Main code"),(0,o.kt)("h3",{id:"our-custom-message-for-esp"},"Our custom message for esp"),(0,o.kt)("p",null,"It is needed to define new type of message for motion sensor - real microcontrollers won't be used in simulation, but message will be the same as in real robot part.\nCreate folder called msg and inside make file called EspTrigger.msg"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"roscd rosbot_patrol_simulation\nmkdir msg\ncd msg\ntouch EspTrigger.msg\n")),(0,o.kt)("p",null,"Inside of this file there will be only two lines:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cpp"},"uint8 id\nbool move\n")),(0,o.kt)("p",null,"id - numer of room where sensor is placed"),(0,o.kt)("p",null,"move - value informing if there is move detected"),(0,o.kt)("h3",{id:"class-files"},"Class files"),(0,o.kt)("p",null,"In include folder create file called PatrolManager.h"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"roscd rosbot_patrol_simulation\ncd include\ntouch PatrolManager.h\n")),(0,o.kt)("p",null,"In this file put following code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cpp"},'#include <iostream>\n#include <ros/ros.h>\n#include <string.h>\n#include <tf/transform_listener.h>\n#include <actionlib/client/simple_action_client.h>\n#include <actionlib/client/terminal_state.h>\n#include <geometry_msgs/PoseStamped.h>\n#include <geometry_msgs/Quaternion.h>\n#include <geometry_msgs/Vector3.h>\n#include <geometry_msgs/Twist.h>\n#include <move_base_msgs/MoveBaseAction.h>\n#include <move_base_msgs/MoveBaseGoal.h>\n#include <vector>\n\nusing namespace std;\nclass PatrolManager\n{\npublic:\n    PatrolManager(ros::NodeHandle &nh);\n    ~PatrolManager();\n    bool moveToGoal(std::string name, float x, float y, float theta);\n    bool makeSpin(double radians, bool clockwise = 1);\n\nprivate:\n    std::vector<double> quaternion_from_euler(double yaw, double pitch, double roll);\n    std::vector<double> quaternion;\n    ros::NodeHandle nh_;             //The node handle we\'ll be using\n    ros::Publisher cmd_vel_pub_;     //We will be publishing to the "cmd_vel" topic to issue commands\n    tf::TransformListener listener_; //We will be listening to TF transforms\n};\n')),(0,o.kt)("p",null,"This class has many libraries included it's because we will be sending goals to action server."),(0,o.kt)("p",null,"Inicializer takes one argument - pointer for node handle, this is because method for making spins require publishing to cmd_vel topic."),(0,o.kt)("p",null,'Other public methods are made for driving to destination described in yaml file and making spin as "scanning".'),(0,o.kt)("p",null,"Once .h file is created let's go create .cpp file, change folder to src and inside it make new file."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"cd .. && cd src\ntouch PatrolManager.cpp\n")),(0,o.kt)("p",null,"Inside paste this code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cpp"},'#include <PatrolManager.h>\n\nusing namespace std;\n\nPatrolManager::PatrolManager(ros::NodeHandle &nh)\n{\n    nh_ = nh;\n    cmd_vel_pub_ = nh_.advertise<geometry_msgs::Twist>("cmd_vel", 1);\n}\n\nPatrolManager::~PatrolManager() {}\n\nbool PatrolManager::makeSpin(double radians, bool clockwise)\n{\n\n    while (radians < 0)\n        radians += 2 * M_PI;\n    while (radians > 2 * M_PI)\n        radians -= 2 * M_PI;\n\n    listener_.waitForTransform(\n        "/base_link", "/odom", ros::Time(0),\n        ros::Duration(1.0)); // wait for the listener to get the first message\n\n    tf::StampedTransform start_transform;\n    tf::StampedTransform current_transform;\n    listener_.lookupTransform("/base_link", "/odom", ros::Time(0), start_transform);\n\n    geometry_msgs::Twist base_cmd;\n    base_cmd.linear.x = base_cmd.linear.y = 0.0;\n    base_cmd.angular.z = 0.75; // set apropirate velocity for robot\n    if (clockwise)\n        base_cmd.angular.z = -base_cmd.angular.z;\n\n    tf::Vector3 desired_turn_axis(0, 0, 1); // the axis we want to be rotating by\n    if (!clockwise)\n        desired_turn_axis = -desired_turn_axis;\n\n    ros::Rate rate(5.0);\n    bool done = false;\n\n    while (!done && nh_.ok())\n    {\n        cmd_vel_pub_.publish(base_cmd);\n        rate.sleep();\n\n        try\n        {\n            listener_.lookupTransform("/base_link", "/odom", ros::Time(0),\n                                      current_transform);\n        }\n        catch (tf::TransformException ex)\n        {\n            ROS_ERROR("%s", ex.what());\n            break;\n        }\n        // see how far we\'ve traveled\n        tf::Transform relative_transform =\n            start_transform.inverse() * current_transform;\n        tf::Vector3 actual_turn_axis = relative_transform.getRotation().getAxis();\n        double angle_turned = relative_transform.getRotation().getAngle();\n        if (fabs(angle_turned) < 1.0e-2) //to make less computation if there is not much rotation made\n        {\n            continue;\n        }\n\n        if (actual_turn_axis.dot(desired_turn_axis) < 0)\n        {\n            angle_turned = 2 * M_PI - angle_turned;\n        }\n        if (angle_turned > radians)\n        {\n            done = true;\n        }\n    }\n    if (done)\n    {\n        return true;\n    }\n    else\n    {\n        return false;\n    }\n}\n\nbool PatrolManager::moveToGoal(std::string the_name, float the_x, float the_y,\n                               float the_theta)\n{\n    actionlib::SimpleActionClient<move_base_msgs::MoveBaseAction> ac("move_base",\n                                                                     true);\n\n    while (!ac.waitForServer(ros::Duration(5.0)))\n    {\n        ROS_INFO("Waiting for the move_base action server to come up");\n    }\n\n    move_base_msgs::MoveBaseGoal goal;\n\n    goal.target_pose.header.frame_id = "map";\n    goal.target_pose.header.stamp = ros::Time::now();\n    goal.target_pose.pose.position.x = the_x;\n    goal.target_pose.pose.position.y = the_y;\n    quaternion = quaternion_from_euler(0.0, 0.0, the_theta);\n    goal.target_pose.pose.orientation.x = quaternion[0];\n    goal.target_pose.pose.orientation.y = quaternion[1];\n    goal.target_pose.pose.orientation.z = quaternion[2];\n    goal.target_pose.pose.orientation.w = quaternion[3];\n\n    ROS_INFO("Sending goal location :");\n    printf("x: %f ,y: %f ,th: %f ", the_x, the_y, the_theta);\n    ac.sendGoal(goal);\n    ac.waitForResult(); //wait until the result is given\n\n    if (ac.getState() == actionlib::SimpleClientGoalState::SUCCEEDED)\n    {\n        ROS_INFO("Robot reached it\'s destination and started scanning area");\n        return true;\n    }\n    else\n    {\n        ROS_INFO("The robot failed to reach the destination check that");\n        return false;\n    }\n}\n\nstd::vector<double>\nPatrolManager::quaternion_from_euler(double roll, double pitch, double yaw) //method just to convert quaternion from euler - to give user clearance\n{\n\n    std::vector<double> quat;\n\n    // Abbreviations for the various angular functions\n    double cy = cos(yaw * 0.5);\n    double sy = sin(yaw * 0.5);\n    double cp = cos(pitch * 0.5);\n    double sp = sin(pitch * 0.5);\n    double cr = cos(roll * 0.5);\n    double sr = sin(roll * 0.5);\n\n    quat.push_back(cy * cp * sr - sy * sp * cr); // x\n    quat.push_back(sy * cp * sr + cy * sp * cr); // y\n    quat.push_back(sy * cp * cr - cy * sp * sr); // z\n    quat.push_back(cy * cp * cr + sy * sp * sr); // w\n\n    return quat;\n}\n')),(0,o.kt)("h3",{id:"main-file"},"Main file"),(0,o.kt)("p",null,"In src directory create another file called patrol_robot_simulation.cpp"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"touch patrol_robot_simulation.cpp\n")),(0,o.kt)("p",null,"In this file paste following code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cpp"},'#include <PatrolManager.h>\n#include <darknet_ros_msgs/BoundingBoxes.h>\n#include <ros/ros.h>\n#include <rosbot_patrol_simulation/EspTrigger.h>\n#include <std_msgs/Bool.h>\n#include <stdio.h>\n#include <vector>\n#include <yaml-cpp/yaml.h>\n\nusing namespace std;\n\nstring params_path, email_from, email_to;\nbool room_reached = {0};\nbool starting_poit_reached = {0};\nros::Time last_email_sent;\nros::NodeHandle *nh_ptr;\n\nvector<string> room_names{}; //initialization of vectors for our destination points\nvector<double> x_coordinates{};\nvector<double> y_coordinates{};\nvector<double> th_coordinates{};\n\nvoid sendMail(const char *to, const char *from, const char *subject,\n              const char *message)\n{\n    ROS_INFO("Sending mail!!!");\n    // int retval = -1;\n    FILE *mailpipe = popen("/usr/lib/sendmail -t", "w");\n    if (mailpipe != NULL)\n    {\n        fprintf(mailpipe, "To: %s\\n", to);\n        fprintf(mailpipe, "From: %s\\n", from);\n        fprintf(mailpipe, "Subject: %s\\n\\n", subject);\n        fwrite(message, 1, strlen(message), mailpipe);\n        fwrite(".\\n", 1, 2, mailpipe);\n        pclose(mailpipe);\n        // retval = 0;\n    }\n    else\n    {\n        perror("Failed to invoke sendmail");\n    }\n    // return retval;\n}\n\nvoid saveConfigFiles(string path)\n{\n    ROS_INFO("path is : %s", path.c_str());\n    YAML::Node conf_file = YAML::LoadFile(path.c_str());\n    for (int i = 0; i < conf_file["rooms_num"].as<int>(); i++)\n    {\n        x_coordinates.push_back(\n            conf_file["rooms"]["room" + to_string(i)]["x"].as<double>());\n        y_coordinates.push_back(\n            conf_file["rooms"]["room" + to_string(i)]["y"].as<double>());\n        th_coordinates.push_back(\n            conf_file["rooms"]["room" + to_string(i)]["angle"].as<double>());\n        room_names.push_back(\n            conf_file["rooms"]["room" + to_string(i)]["name"].as<std::string>());\n    }\n}\n\nvoid darknetCallback(const darknet_ros_msgs::BoundingBoxes &bb_msg)\n{\n\n    int size =\n        bb_msg.bounding_boxes.size(); // ros msgs are mapped onto std::vector\n    for (int i = 0; i < size; i++)\n    {\n        // ROS_INFO("checking for obj");\n        if ((bb_msg.bounding_boxes[i].Class == "fire hydrant") or\n            (bb_msg.bounding_boxes[i].Class == "person"))\n        {\n            ROS_INFO("Found fire hydrant or person/people");\n\n            ros::Time time_now = ros::Time::now();\n            if (time_now - last_email_sent >= ros::Duration(10))\n            {\n                sendMail(email_to.c_str(), email_from.c_str(), "rosbot patrol node", "I have found something strange it could be invader");\n                last_email_sent = time_now;\n            }\n        }\n    }\n}\n\nvoid espCallback(const rosbot_patrol_simulation::EspTrigger &trigger_msg)\n{\n    bool spin_made;\n\n    if (trigger_msg.move == 1)\n    {\n        int esp_id = trigger_msg.id;\n        PatrolManager pn(*nh_ptr);\n\n        room_reached = pn.moveToGoal(room_names[esp_id], x_coordinates[esp_id],\n                                     y_coordinates[esp_id], th_coordinates[esp_id]);\n        if (room_reached)\n        {\n            ROS_INFO("I\'ve reached destination");\n        }\n\n        spin_made = pn.makeSpin(M_PI , 0);\n        spin_made = pn.makeSpin(M_PI , 0);\n        if (spin_made)\n        {\n            ROS_INFO("I\'ve just scanned room");\n        }\n\n        starting_poit_reached = pn.moveToGoal(room_names[0], x_coordinates[0],\n                                              y_coordinates[0], th_coordinates[0]);\n        if (starting_poit_reached)\n        {\n            ROS_INFO("I\'ve reached starting_poit_reached");\n        }\n    }\n}\n\nint main(int argc, char *argv[])\n{\n    ros::init(argc, argv, "patrol_robot_simulation");\n    ros::NodeHandle nh("~");\n    nh_ptr = &nh;\n    nh.getParam("path_to_params", params_path);\n    nh.getParam("email_to", email_to);\n    nh.getParam("email_from", email_from);\n    printf("path : %s", params_path.c_str());\n    saveConfigFiles(params_path);\n\n    ros::Subscriber sub_esp = nh.subscribe("/motion_trigger", 1, espCallback);\n    ros::Subscriber sub_darknet =\n        nh.subscribe("/darknet_ros/bounding_boxes", 10, darknetCallback);\n\n    ros::Rate loop_rate(50);\n    last_email_sent = ros::Time::now();\n    while (ros::ok)\n    {\n\n        ros::spinOnce();\n        loop_rate.sleep();\n    }\n\n    return 0;\n}\n')),(0,o.kt)("p",null,"remember to change permission for file by running following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"chmod +x patrol_robot_simulation.cpp\nchmod +x PatrolManager.cpp\n")),(0,o.kt)("h2",{id:"cmakelists-and-package"},"CMakeLists and package"),(0,o.kt)("p",null,"In CMakeLists.txt paste following code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-C"},"cmake_minimum_required(VERSION 2.8.3)\nproject(rosbot_patrol_simulation)\n\nadd_compile_options(-std=c++11)\n\nfind_package(catkin REQUIRED COMPONENTS\n  message_generation\n  geometry_msgs\n  gmapping\n  move_base\n  roscpp\n  rospy\n  tf\n  darknet_ros\n)\n\nfind_package( OpenCV REQUIRED )\n\nadd_message_files(FILES\n  EspTrigger.msg\n)\n\ngenerate_messages(DEPENDENCIES\n  std_msgs\n)\n\ncatkin_package(\n  CATKIN_DEPENDS\n  message_runtime\n)\n\ninclude_directories(\n  include ${catkin_INCLUDE_DIRS}\n  ${catkin_INCLUDE_DIRS}\n  ${OpenCV_INCLUDE_DIRS}\n)\n\nadd_executable(patrol_robot_simulation src/patrol_robot_simulation.cpp src/PatrolManager.cpp)\nadd_dependencies(patrol_robot_simulation ${${PROJECT_NAME}_EXPORTED_TARGETS} ${catkin_EXPORTED_TARGETS})\ntarget_link_libraries(patrol_robot_simulation\n  ${catkin_LIBRARIES} yaml-cpp\n)\n")),(0,o.kt)("p",null,"To file package.xml paste following code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},'<?xml version="1.0"?>\n<package format="2">\n  <name>rosbot_patrol_simulation</name>\n  <version>0.0.0</version>\n  <description>The rosbot_patrol_simulation package</description>\n\n  <maintainer email="adam-krawczyk@outlook.com">adam</maintainer>\n\n  <license>TODO</license>\n\n  <buildtool_depend>catkin</buildtool_depend>\n  <build_depend>roscpp</build_depend>\n  <build_depend>rospy</build_depend>\n  <build_export_depend>roscpp</build_export_depend>\n  <build_export_depend>rospy</build_export_depend>\n  <exec_depend>roscpp</exec_depend>\n  <exec_depend>rospy</exec_depend>\n\n  \x3c!-- The export tag contains other, unspecified, tags --\x3e\n  <export>\n    \x3c!-- Other tools can request additional information be placed here --\x3e\n\n  </export>\n<build_depend>message_generation</build_depend>\n<build_export_depend>message_generation</build_export_depend>\n<exec_depend>message_runtime</exec_depend>\n<build_depend> darknet_ros </build_depend>\n<build_depend>common_rosdeps</build_depend>\n<exec_depend>common_rosdeps</exec_depend>\n</package>\n')),(0,o.kt)("h2",{id:"create-room-points"},"Create room points"),(0,o.kt)("p",null,"Next step is to create points to where robot must drive when motion sensor detect movement.\nThe construct have very nice method to have these points so follow him with this tuturial."),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=p-ZG6E-PZVA&t=7s"},"how to get goal points")," start at 30:00.\n",(0,o.kt)("img",{alt:"how_to_get_points",src:a(61042).Z,width:"1488",height:"68"})),(0,o.kt)("p",null,"So in this case to get this points it is recomended to start gmapping, drive robot to desired point and get coordinates of this point from Rviz."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"roslaunch rosbot_patrol_simulation simulation_gmapping.launch")),(0,o.kt)("p",null,"On the other terminal launch rviz:"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"rviz")),(0,o.kt)("p",null,"Once points are known lets create yaml file with those points.\nIn rosbot_patrol_simulation pkg create new folder called params"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"cd ..\nmkdir params\ncd params && touch room_points.yaml\n")),(0,o.kt)("p",null,"In room_points.yaml file place found points with following convention:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'#name rooms must be numerated consequently as room<num>  \n\nrooms_num: 11   #remember that is enumerated from 0\nrooms:\n  room0:\n    name: "base/return point" #if it\'s set to 0,0,0 robot will go back to start point \n    x:      0\n    y:      0\n    angle:  0\n\n  room1:\n    name: "room1-name"\n    x:      2.819\n    y:      -0.175\n    angle:  0\n\n  room2:\n    name: "room2-name"\n    x:      -3.489\n    y:      0.306\n    angle:  0   \n\n  room3:\n    name: "room3-name"\n    x:      -4.786\n    y:      3.412\n    angle:  0\n\n  room4:\n    name: "room4-name"\n    x:      -3.848\n    y:      6.496\n    angle:  0\n\n  room5:\n    name: "room5-name"\n    x:      2.682\n    y:      7.352\n    angle:  0   \n\n  room6:\n    name: "room6-name"\n    x:      5.651\n    y:      12.038\n    angle:  0\n\n  room7:\n    name: "room7-name"\n    x:      14.750\n    y:      11.480\n    angle:  0\n\n  room8:\n    name: "room8 - name"\n    x:      0.21\n    y:      0.5942\n    angle:  0\n\n\n  room9:\n    name: "room8 - name"\n    x:      -0.01\n    y:      0.542\n    angle:  45\n\n\n  room10:\n    name: "room8 - name"\n    x:      -0.21\n    y:      -0.42\n    angle:  180\n')),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"rosbot_room_plan",src:a(81394).Z,width:"1146",height:"814"})),(0,o.kt)("p",null,"This are points for model.world world remember to set point0 to all zeroes - it's point to where robot will be coming back after patrolling room."),(0,o.kt)("h2",{id:"yolo-setup"},"Yolo setup"),(0,o.kt)("p",null,"Next we need to setup neural network - for that we will use pre-trained model. In config directory we create for this purpose config file."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"roscd rosbot_patrol_simulation\ncd config\ntouch darknet_config_simulation.yaml\n")),(0,o.kt)("p",null,"In darknet_config_simulation.yaml:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"subscribers:\n\n  camera_reading:\n    topic: /camera/rgb/image_raw\n    queue_size: 1\n\nactions:\n\n  camera_reading:\n    name: /darknet_ros/check_for_objects\n\npublishers:\n\n  object_detector:\n    topic: /darknet_ros/found_object\n    queue_size: 1\n    latch: false\n\n  bounding_boxes:\n    topic: /darknet_ros/bounding_boxes\n    queue_size: 1\n    latch: false\n\n  detection_image:\n    topic: /darknet_ros/detection_image\n    queue_size: 1\n    latch: true\n\nimage_view:\n\n  enable_opencv: true\n  wait_key_delay: 1\n  enable_console_output: true\n")),(0,o.kt)("p",null,"And that's all - it isn't necessary to change anything else, now create launch file for neural network. In launch directory create new file called darknet_yolo_simulation_only.launch"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"roscd rosbot_patrol_simulation\ncd launch\ntouch darknet_yolo_simulation_only.launch\n")),(0,o.kt)("p",null,"Inside paste following code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},'<launch>\n\n  \x3c!-- Console launch prefix --\x3e\n  <arg name="launch_prefix" default=""/>\n\n  \x3c!-- Config and weights folder. --\x3e\n  <arg name="yolo_weights_path"          default="$(find darknet_ros)/yolo_network_config/weights"/>\n  <arg name="yolo_config_path"           default="$(find darknet_ros)/yolo_network_config/cfg"/>\n\n  \x3c!-- ROS and network parameter files --\x3e\n  <arg name="ros_param_file"             default="$(find rosbot_patrol_simulation)/config/darknet_config_simulation.yaml"/>\n  <arg name="network_param_file"         default="$(find darknet_ros)/config/yolov2-tiny.yaml"/>\n\n  \x3c!-- Load parameters --\x3e\n  <rosparam command="load" ns="darknet_ros" file="$(arg ros_param_file)"/>\n  <rosparam command="load" ns="darknet_ros" file="$(arg network_param_file)"/>\n\n  \x3c!-- Start darknet and ros wrapper --\x3e\n  <node pkg="darknet_ros" type="darknet_ros" name="darknet_ros" output="screen" launch-prefix="$(arg launch_prefix)">\n    <param name="weights_path"          value="$(arg yolo_weights_path)" />\n    <param name="config_path"           value="$(arg yolo_config_path)" />\n  </node>\n\n</launch>\n')),(0,o.kt)("p",null,"At the end we have to wrap whole things to one launch file, create rosbot_patrol.launch"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"touch rosbot_patrol.launch\n")),(0,o.kt)("p",null,"And paste following launch file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},'<?xml version="1.0" encoding="UTF-8"?>\n<launch>\n\n    <include file="$(find rosbot_patrol_simulation)/launch/darknet_yolo_simulation_only.launch"/> \n\n    <include file="$(find rosbot_patrol_simulation)/launch/simulation_world.launch"/> \n\n                        \x3c!-- patrol node --\x3e\n    <node pkg="rosbot_patrol_simulation" type="patrol_robot_simulation" name="patrolling_node" output="screen" respawn="true">\n\n                        \x3c!-- path to file  with  params of points --\x3e \n    <param name="path_to_params" type="string" value="$(find rosbot_patrol_simulation)/params/room_points.yaml" />\n    <param name="email_to" type="string" value="*****@****.***" />  \x3c!-- setup first mailbox on your device!!!!!! --\x3e\n    <param name="email_from" type="string" value="*****@****.***" />\n    </node>\n\n</launch>\n')),(0,o.kt)("h2",{id:"test-this-algorithm"},"Test this algorithm"),(0,o.kt)("p",null,"To make it run simply paste in your terminal this command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"roslaunch rosbot_patrol_simulation rosbot_patrol.launch\n")),(0,o.kt)("p",null,"To start robot running in desired point just publish to the topic robot is listening for move:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'rostopic pub /motion_trigger rosbot_patrol_simulation/EspTrigger "id: 1\nmove: 1"\n')),(0,o.kt)("p",null,"with appropriate id number."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"rosbot_patrol_final",src:a(40936).Z,width:"1596",height:"999"})),(0,o.kt)("h2",{id:"real-robot-part"},"Real robot part"),(0,o.kt)("p",null,"Once simulation is made and our algorithm works now we can implement it to real rosbot"),(0,o.kt)("h2",{id:"introduction-1"},"Introduction"),(0,o.kt)("p",null,"On robot we also have to install all packages form introduction so in case you haven't just install that on your rosbot.\nThere are currently new firmware for rosbot because of that in hardware launch is option to chose which version you have."),(0,o.kt)("p",null,"Let's create our package if you haven't done that before."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"catkin_create_pkg rosbot_patrol roscpp\n")),(0,o.kt)("p",null,"In real robot part some cool features will be needed, like information about move, image processing, path planning. Because current version of rosbot has not enough computing power (nether rosbot 2.0 nor rosbot PRO), so it is necessary to outsource image processing, and this require to implement compressed image transport what will be done. There are many things to do so hold on and stick to instructions. "),(0,o.kt)("h2",{id:"main-code-1"},"Main code"),(0,o.kt)("p",null,"Let's get this rolling!"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"roscd rosbot_patrol\n")),(0,o.kt)("h3",{id:"include"},"Include"),(0,o.kt)("p",null,"In this directory create new file called PatrolManager.h"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"cd include\ntouch PatrolManager.h\n")),(0,o.kt)("p",null,"Paste there following code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cpp"},'#include <iostream>\n#include <ros/ros.h>\n#include <string.h>\n#include <tf/transform_listener.h>\n#include <actionlib/client/simple_action_client.h>\n#include <actionlib/client/terminal_state.h>\n#include <geometry_msgs/PoseStamped.h>\n#include <geometry_msgs/Quaternion.h>\n#include <geometry_msgs/Vector3.h>\n#include <geometry_msgs/Twist.h>\n#include <move_base_msgs/MoveBaseAction.h>\n#include <move_base_msgs/MoveBaseGoal.h>\n#include <vector>\n\nusing namespace std;\nclass PatrolManager\n{\npublic:\n    PatrolManager(ros::NodeHandle &nh);\n    ~PatrolManager();\n    bool moveToGoal(std::string name, float x, float y, float theta);\n    bool makeSpin(double radians, bool clockwise = 1);\n\nprivate:\n    std::vector<double> quaternion_from_euler(double yaw, double pitch, double roll);\n    std::vector<double> quaternion;\n    ros::NodeHandle nh_;             //The node handle we\'ll be using\n    ros::Publisher cmd_vel_pub_;     //We will be publishing to the "cmd_vel" topic to issue commands\n    tf::TransformListener listener_; //We will be listening to TF transforms\n};\n')),(0,o.kt)("h3",{id:"src"},"Src"),(0,o.kt)("p",null,"Now we should create two files in src directory PatrolManager.cpp and patrol_robot.cpp ."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"roscd rosbot_patrol\ncd src\ntouch PatrolManager.cpp\ntouch patrol_robot.cpp\n")),(0,o.kt)("p",null,"In PatrolManager.cpp paste following code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cpp"},'#include <PatrolManager.h>\n\nusing namespace std;\n\nPatrolManager::PatrolManager(ros::NodeHandle &nh)\n{\n    nh_ = nh;\n    cmd_vel_pub_ = nh_.advertise<geometry_msgs::Twist>("cmd_vel", 1);\n}\n\nPatrolManager::~PatrolManager() {}\n\nbool PatrolManager::makeSpin(double radians, bool clockwise)\n{\n\n    while (radians < 0)\n        radians += 2 * M_PI; // to perform rotation for more than 360 /-360\n    while (radians > 2 * M_PI)\n        radians -= 2 * M_PI;\n\n    listener_.waitForTransform(\n        "/base_link", "/odom", ros::Time(0),\n        ros::Duration(1.0)); // wait for the listener to get the first message\n\n    tf::StampedTransform start_transform;\n    tf::StampedTransform current_transform;\n    listener_.lookupTransform("/base_link", "/odom", ros::Time(0), start_transform);\n\n    geometry_msgs::Twist base_cmd;\n    base_cmd.linear.x = base_cmd.linear.y = 0.0;\n    base_cmd.angular.z = 0.75; // set apropirate velocity for robot\n    if (clockwise)\n        base_cmd.angular.z = -base_cmd.angular.z;\n\n    tf::Vector3 desired_turn_axis(0, 0, 1); // the axis we want to be rotating by\n    if (!clockwise)\n        desired_turn_axis = -desired_turn_axis;\n\n    ros::Rate rate(5.0);\n    bool done = false;\n    // bool spin_done = false;\n\n    while (!done && nh_.ok())\n    {\n        cmd_vel_pub_.publish(base_cmd);\n        rate.sleep();\n\n        try\n        {\n            listener_.lookupTransform("/base_link", "/odom", ros::Time(0),\n                                      current_transform);\n        }\n        catch (tf::TransformException ex)\n        {\n            ROS_ERROR("%s", ex.what());\n            break;\n        }\n        // see how far we\'ve traveled\n        tf::Transform relative_transform =\n            start_transform.inverse() * current_transform;\n        tf::Vector3 actual_turn_axis = relative_transform.getRotation().getAxis();\n        double angle_turned = relative_transform.getRotation().getAngle();\n        if (fabs(angle_turned) < 1.0e-2)\n        {\n            continue;\n        }\n\n        if (actual_turn_axis.dot(desired_turn_axis) < 0)\n        {\n            angle_turned = 2 * M_PI - angle_turned;\n        }\n        if (angle_turned > radians)\n        {\n            done = true;\n        }\n    }\n    if (done)\n    {\n        return true;\n    }\n    else\n    {\n        return false;\n    }\n}\n\nbool PatrolManager::moveToGoal(std::string the_name, float the_x, float the_y,\n                               float the_theta)\n{\n    actionlib::SimpleActionClient<move_base_msgs::MoveBaseAction> ac("move_base",\n                                                                     true);\n\n    while (!ac.waitForServer(ros::Duration(5.0)))\n    {\n        ROS_INFO("Waiting for the move_base action server to come up");\n    }\n\n    move_base_msgs::MoveBaseGoal goal;\n\n    goal.target_pose.header.frame_id = "map";\n    goal.target_pose.header.stamp = ros::Time::now();\n    goal.target_pose.pose.position.x = the_x;\n    goal.target_pose.pose.position.y = the_y;\n    quaternion = quaternion_from_euler(0.0, 0.0, the_theta);\n    goal.target_pose.pose.orientation.x = quaternion[0];\n    goal.target_pose.pose.orientation.y = quaternion[1];\n    goal.target_pose.pose.orientation.z = quaternion[2];\n    goal.target_pose.pose.orientation.w = quaternion[3];\n\n    ROS_INFO("Sending goal location :");\n    printf("x: %f ,y: %f ,th: %f ", the_x, the_y, the_theta);\n    ac.sendGoal(goal);\n    ac.waitForResult();\n\n    if (ac.getState() == actionlib::SimpleClientGoalState::SUCCEEDED)\n    {\n        ROS_INFO("Robot reached it\'s destination and started scanning area");\n        return true;\n    }\n    else\n    {\n        ROS_INFO("The robot failed to reach the destination check that");\n        return false;\n    }\n}\n\nstd::vector<double>\nPatrolManager::quaternion_from_euler(double roll, double pitch, double yaw)\n{\n\n    std::vector<double> quat;\n\n    // Abbreviations for the various angular functions\n    double cy = cos(yaw * 0.5);\n    double sy = sin(yaw * 0.5);\n    double cp = cos(pitch * 0.5);\n    double sp = sin(pitch * 0.5);\n    double cr = cos(roll * 0.5);\n    double sr = sin(roll * 0.5);\n\n    quat.push_back(cy * cp * sr - sy * sp * cr); // x\n    quat.push_back(sy * cp * sr + cy * sp * cr); // y\n    quat.push_back(sy * cp * cr - cy * sp * sr); // z\n    quat.push_back(cy * cp * cr + sy * sp * sr); // w\n\n    return quat;\n}\n')),(0,o.kt)("p",null,"Then paste following code to patrol_robot.cpp :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cpp"},'#include <PatrolManager.h>\n#include <darknet_ros_msgs/BoundingBoxes.h>\n#include <ros/ros.h>\n#include <rosbot_patrol/EspTrigger.h>\n#include <std_msgs/Bool.h>\n#include <stdio.h>\n#include <vector>\n#include <yaml-cpp/yaml.h>\n\nusing namespace std;\n\nstring params_path, email_from, email_to;\nbool room_reached = {0};\nbool starting_poit_reached = {0};\nros::Time last_email_sent;\nros::NodeHandle *nh_ptr;\n\nvector<string> room_names{};\nvector<double> x_coordinates{};\nvector<double> y_coordinates{};\nvector<double> th_coordinates{};\n\nvoid sendMail(const char *to, const char *from, const char *subject,\n              const char *message)\n{\n    // int retval = -1;\n    FILE *mailpipe = popen("/usr/lib/sendmail -t", "w");\n    if (mailpipe != NULL)\n    {\n        fprintf(mailpipe, "To: %s\\n", to);\n        fprintf(mailpipe, "From: %s\\n", from);\n        fprintf(mailpipe, "Subject: %s\\n\\n", subject);\n        fwrite(message, 1, strlen(message), mailpipe);\n        fwrite(".\\n", 1, 2, mailpipe);\n        pclose(mailpipe);\n        // retval = 0;\n    }\n    else\n    {\n        perror("Failed to invoke sendmail");\n    }\n    // return retval;\n}\n\nvoid saveConfigFiles(string path)\n{\n    ROS_INFO("path is : %s", path.c_str());\n    YAML::Node conf_file = YAML::LoadFile(path.c_str());\n    for (int i = 0; i < conf_file["rooms_num"].as<int>(); i++)\n    {\n        x_coordinates.push_back(\n            conf_file["rooms"]["room" + to_string(i)]["x"].as<double>());\n        y_coordinates.push_back(\n            conf_file["rooms"]["room" + to_string(i)]["y"].as<double>());\n        th_coordinates.push_back(\n            conf_file["rooms"]["room" + to_string(i)]["angle"].as<double>());\n        room_names.push_back(\n            conf_file["rooms"]["room" + to_string(i)]["name"].as<std::string>());\n    }\n}\n\nvoid darknetCallback(const darknet_ros_msgs::BoundingBoxes &bb_msg)\n{\n\n    int size =\n        bb_msg.bounding_boxes.size(); // ros msgs are mapped onto std::vector\n    for (int i = 0; i < size; i++)\n    {\n        // ROS_INFO("checking for obj");\n        if ((bb_msg.bounding_boxes[i].Class == "fire hydrant") or\n            (bb_msg.bounding_boxes[i].Class == "person"))\n        {\n            ROS_INFO("Found fire hydrant or person/people");\n\n            ros::Time time_now = ros::Time::now();\n            if (time_now - last_email_sent >= ros::Duration(10))\n            {\n                sendMail(email_to.c_str(), email_from.c_str(), "rosbot patrol node",\n                         "I have found something strange it could be invader");\n                last_email_sent = time_now;\n            }\n        }\n    }\n}\n\nvoid espCallback(const rosbot_patrol::EspTrigger &trigger_msg)\n{\n    bool spin_made;\n\n    // const char[] command = "mail -s \\"test\\" " + email_addr + " <<< \\"im in\n    // espCallback\\" ";\n    // auto response = system("mail -s \\"test\\" " + email_addr + " <<< \\"im in\n    // espCallback\\" ") ; // <--- place all this to darknetCb\n    // ROS_INFO("im in espCallback");\n\n    if (trigger_msg.move == 1)\n    {\n        int esp_id = trigger_msg.id;\n        PatrolManager pn(*nh_ptr);\n\n        room_reached = pn.moveToGoal(room_names[esp_id], x_coordinates[esp_id],\n                                     y_coordinates[esp_id], th_coordinates[esp_id]);\n        if (room_reached)\n        {\n            ROS_INFO("I\'ve reached destination");\n        }\n\n        spin_made = pn.makeSpin(M_PI , 0);\n        spin_made = pn.makeSpin(M_PI , 0);\n        if (spin_made)\n        {\n            ROS_INFO("I\'ve just scanned room");\n        }\n\n        starting_poit_reached = pn.moveToGoal(room_names[0], x_coordinates[0],\n                                              y_coordinates[0], th_coordinates[0]);\n        if (starting_poit_reached)\n        {\n            ROS_INFO("I\'ve reached starting_poit_reached");\n        }\n    }\n}\n\nint main(int argc, char *argv[])\n{\n    ros::init(argc, argv, "patrol_robot_node");\n    ros::NodeHandle nh("~");\n    nh_ptr = &nh;\n    nh.getParam("path_to_params", params_path);\n    nh.getParam("email_to", email_to);\n    nh.getParam("email_from", email_from);\n    printf("path : %s", params_path.c_str());\n    saveConfigFiles(params_path);\n\n    ros::Subscriber sub_esp = nh.subscribe("/motion_trigger", 1, espCallback);\n    ros::Subscriber sub_darknet =\n        nh.subscribe("/darknet_ros/bounding_boxes", 100, darknetCallback);\n\n    ros::Rate loop_rate(50);\n    last_email_sent = ros::Time::now();\n    while (ros::ok)\n    {\n\n        ros::spinOnce();\n        loop_rate.sleep();\n    }\n\n    return 0;\n}\n')),(0,o.kt)("p",null,"remember to change permission for file by running following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"chmod +x patrol_robot.cpp\nchmod +x PatrolManager.cpp\n")),(0,o.kt)("h2",{id:"hardware-launches"},"Hardware launches"),(0,o.kt)("p",null,"For this task is required to launch some things, all of them should be wrapped up as rosbot_all_hardware.launch  In here there is option to change launch varing of rosbot firmware version. "),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"camera"),(0,o.kt)("li",{parentName:"ol"},"connection to core2 - controller for motors"),(0,o.kt)("li",{parentName:"ol"},"transform publishers for our sensor"),(0,o.kt)("li",{parentName:"ol"},"lidar")),(0,o.kt)("p",null,"Create in launch directory file called rosbot_all_hardware.launch"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"roscd rosbot_patrol\nmkdir launch\ncd launch && touch rosbot_all_hardware.launch\n")),(0,o.kt)("p",null,"In this new file paste following code:"),(0,o.kt)("p",null,"REMEMBER TO SET CORRECT PART FOR YOUR FIRMWARE AND ROSBOT VERSION!!!"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},'<?xml version="1.0" encoding="UTF-8"?>\n<launch>\n\n    <arg name="rosbot_version" default="$(optenv ROSBOT_VER)"/>\n\n    <include file="$(find astra_camera)/launch/astra.launch"/>\n\n    <include file="$(find rplidar_ros)/launch/rplidar.launch"/>\n\n    <node pkg="tf" type="static_transform_publisher" name="laser_publisher" args="0 0 0.058 3.14159 0 0 base_link laser 100" />\n\n    <node pkg="tf" type="static_transform_publisher" name="imu_publisher" args="0 0 0.02 0 0 0 base_link imu_link 100" />\n\n    <node pkg="tf" type="static_transform_publisher" name="camera_publisher" args="-0.03 0 0.18 0 0 0 base_link camera_link 100" />\n\n\x3c!-- here you have to chose appropirate launch depending on your rosbot firmware - I\'m strongly recommend to install new firmware it has some utilites including Extended Kalman Filter --\x3e\n\n    \n    \x3c!-- NEW FIRMWARE --\x3e\n    <include file="$(find rosbot_ekf)/launch/all.launch"/>\n \n    \x3c!-- OLD FIRMWARE --\x3e\n   \x3c!--  \n    <node pkg="tutorial_pkg" type="drive_controller_node" name="drive_controller"/> \n    <node pkg="tutorial_pkg" type="serial_bridge.sh" name="serial_bridge"   /> \n    --\x3e\n\n</launch>\n')),(0,o.kt)("p",null,"You have to specify which rosbot firmware are you using - since new version is fresh it's very likely that you're using old version"),(0,o.kt)("p",null,"NOTE: Remember about ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/byq77/rosbot_ekf"},"rosbot_ekf")," package. "),(0,o.kt)("p",null,"You can upgrade it using this instruction ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/husarion/rosbot-firmware-new"},"rosbot new firmware")),(0,o.kt)("h2",{id:"now-we-need-to-focus-about-algorithm"},"Now we need to focus about algorithm."),(0,o.kt)("p",null,"We need launches for:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"move base"),(0,o.kt)("li",{parentName:"ol"},"gmapping"),(0,o.kt)("li",{parentName:"ol"},"AMCL")),(0,o.kt)("h3",{id:"move-base"},"Move base"),(0,o.kt)("p",null,"In launch folder create new file called move_base_only.launch and paste following code inside."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"touch move_base_only.launch\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},'<launch>\n\n    <node pkg="move_base" type="move_base" name="move_base" output="log">\n        <param name="controller_frequency" value="10.0"/>\n        <rosparam file="$(find tutorial_pkg)/config/costmap_common_params.yaml" command="load" ns="global_costmap" />\n        <rosparam file="$(find tutorial_pkg)/config/costmap_common_params.yaml" command="load" ns="local_costmap" />\n        <rosparam file="$(find tutorial_pkg)/config/local_costmap_params.yaml" command="load" />\n        <rosparam file="$(find tutorial_pkg)/config/global_costmap_params.yaml" command="load" />\n        <rosparam file="$(find tutorial_pkg)/config/trajectory_planner.yaml" command="load" />\n    </node>\n\n</launch>\n')),(0,o.kt)("h3",{id:"amcl-1"},"AMCL"),(0,o.kt)("p",null,"In launch folder create new file called amcl_only.launch"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"touch amcl_only.launch\n")),(0,o.kt)("p",null,"Paste there following code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},'<launch>\n    \n    <node pkg="amcl" type="amcl" name="amcl" output="screen">\n        <remap from="scan" to="/scan"/>\n        <param name="odom_frame_id" value="odom"/>\n        <param name="odom_model_type" value="diff-corrected"/>\n        <param name="base_frame_id" value="base_link"/>\n        <param name="update_min_d" value="0.1"/>\n        <param name="update_min_a" value="0.2"/>\n        <param name="min_particles" value="500"/>\n        <param name="global_frame_id" value="map"/>\n        <param name="tf_broadcast" value="true" />\n\n    </node>\n   \n</launch>\n')),(0,o.kt)("h3",{id:"gmapping"},"Gmapping"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"touch gmapping_only.launch\n")),(0,o.kt)("p",null,"Paste this code inside:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},'<launch>\n\n  <node pkg="gmapping" type="slam_gmapping" name="slam_gmapping" output="screen">\n    <remap from="/base_scan" to="/scan"/>\n\n    <param name="base_frame" value="base_link"/>\n    <param name="map_frame" value="map"/>\n    <param name="odom_frame" value="odom"/>\n\n    <param name="map_update_interval" value="5.0"/>\n    <param name="maxUrange" value="16.0"/>\n    <param name="sigma" value="0.05"/>\n    <param name="kernelSize" value="1"/>\n    <param name="lstep" value="0.05"/>\n    <param name="astep" value="0.05"/>\n    <param name="iterations" value="5"/>\n    <param name="lsigma" value="0.075"/>\n    <param name="ogain" value="3.0"/>\n    <param name="lskip" value="0"/>\n    <param name="srr" value="0.1"/>\n    <param name="srt" value="0.2"/>\n    <param name="str" value="0.1"/>\n    <param name="stt" value="0.2"/>\n    <param name="linearUpdate" value="0.05"/>\n    <param name="angularUpdate" value="0.05"/>\n    <param name="temporalUpdate" value="0.5"/>\n    <param name="resampleThreshold" value="0.5"/>\n    <param name="particles" value="30"/>\n    <param name="xmin" value="-50.0"/>\n    <param name="ymin" value="-50.0"/>\n    <param name="xmax" value="50.0"/>\n    <param name="ymax" value="50.0"/>\n    <param name="delta" value="0.05"/>\n    <param name="llsamplerange" value="0.01"/>\n    <param name="llsamplestep" value="0.01"/>\n    <param name="lasamplerange" value="0.005"/>\n    <param name="lasamplestep" value="0.005"/>\n  </node>\n\n</launch>\n')),(0,o.kt)("p",null,"Now create launch for maping."),(0,o.kt)("p",null,"In launch directory create file rosbot_gmapping.launch and paste following code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"touch rosbot_gmapping.launch\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},'\n<?xml version="1.0" encoding="UTF-8"?>\n<launch>\n\n    <include file="$(find rosbot_patrol)/launch/rosbot_all_hardware.launch"/>\n    <include file="$(find rosbot_patrol)/launch/move_base_only.launch"/>\n    <node pkg="teleop_twist_keyboard" type="teleop_twist_keyboard.py" name="teleop_twist_keyboard" output="screen"/>\n    <include file="$(find rosbot_patrol)/launch/gmapping_only.launch" />        \n\n</launch>\n')),(0,o.kt)("p",null,"To start mapping run following command:"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"catkin_make"),(0,o.kt)("br",{parentName:"p"}),"\n",(0,o.kt)("inlineCode",{parentName:"p"},"roslaunch rosbot_patrol rosbot_gmapping.launch")),(0,o.kt)("p",null,"Then in different terminal launch:"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"rviz")),(0,o.kt)("p",null,"You should be able to see how robot is mapping.\nAfter that open another terminal and save map:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"roscd rosbot_patrol\nmkdir maps && cd maps\nrosrun map_server map_saver -f rosbot_map\n")),(0,o.kt)("h3",{id:"find-coordinates-for-move-sensor"},"Find coordinates for move sensor"),(0,o.kt)("p",null,"If we already are able to drive on this map we have to find coordinates to where robot should drive. There is still the same method as during simulation so use Ricardo's method :"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=p-ZG6E-PZVA&t=7s"},"how to get goal points")," start at 30:00."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"how_to_get_points",src:a(61042).Z,width:"1488",height:"68"})),(0,o.kt)("p",null,"Once we have points lets create yaml file with those points.\nIn rosbot_patrol pkg create new folder called params"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cd",metastring:"..","..":!0},"mkdir params\ncd params && touch room_points.yaml\n")),(0,o.kt)("p",null,"Put appropriate data, if you have less sensors just remove unnecessary room names if you have more rooms simply add more and change rooms_num to appropriate for your new room number.\nIn room_points.yaml file place your points with following convention:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'#name rooms must be numerated consequently as room<num>  \n\nrooms_num: 8   #remember that is enumerated from 0\nrooms:\n  room0:\n    name: "base/return point" #if it\'s set to 0,0,0 robot will go back to start point \n    x:    0\n    y:    0\n    angle: 0\n\n  room1:\n    name: "room1-name"\n    x:    2.819\n    y:    -0.175\n    angle: 0\n\n  room2:\n    name: "room2-name"\n    x:    -3.489\n    y:    0.306\n    angle: 0   \n\n  room3:\n    name: "room3-name"\n    x:    -4.786\n    y:    3.412\n    angle: 0\n\n  room4:\n    name: "room4-name"\n    x:    -3.848\n    y:    6.496\n    angle: 0\n\n  room5:\n    name: "room5-name"\n    x:    2.682\n    y:    7.352\n    angle: 0   \n\n  room6:\n    name: "room6-name"\n    x:    5.651\n    y:    12.038\n    angle: 0\n\n  room7:\n    name: "room7-name"\n    x:    14.750\n    y:    11.480\n    angle: 0\n')),(0,o.kt)("p",null,"This are points for model.world world remember to set point0 to all zeroes - it's point to where robot will be coming back after patrolling room."),(0,o.kt)("h2",{id:"setup-esp32"},"Setup ESP32"),(0,o.kt)("p",null,"To make ESP32 work it's needed to make some steps. First of them is to proper setup environment, I will not be explaining because here is link to my project showing how to make that properly it is also basic usage:"),(0,o.kt)("p",null,"Remember to set it up on your computer!"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.hackster.io/khasreto/run-rosserial-over-the-internet-with-esp32-0615f5"},"setup esp32")),(0,o.kt)("p",null,"Once it is working working we need to setup rosserial to works with husarnet - this will give ability to use ESP32 microcontrollers for sending information about potential movement.\nTo make it works it's needed to remove current version of rosserial and install the one made for husarnet"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo apt-get remove ros-melodic-rosserial*\n")),(0,o.kt)("p",null,"Then go to my github and clone to workspace repository from ",(0,o.kt)("inlineCode",{parentName:"p"},"ipv6-husarnet branch")," ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/adamkrawczyk/rosserial/tree/ipv6-husarnet"},"ipv6-husarnet")," or use following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cd ~/ros_workspace/src\ngit clone --single-branch --branch ipv6-husarnet https://github.com/adamkrawczyk/rosserial.git\n")),(0,o.kt)("p",null,"Next thing is to make custom message to do, so it is required to make directory called msg and inside there create new file called EspTrigger.msg"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"roscd rosbot_patrol\nmkdir msg\ncd msg\ntouch EspTrigger.msg\n")),(0,o.kt)("p",null,"Inside of this file there will be only two lines:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cpp"},"uint8 id\nbool move\n")),(0,o.kt)("p",null,"id - numer of room where sensor is placed"),(0,o.kt)("p",null,"move - value informing if there is move detected"),(0,o.kt)("h2",{id:"cmakelist-and-package"},"CMakeList and package"),(0,o.kt)("p",null,"after this let's update CMakeList and package.xml:"),(0,o.kt)("p",null,"paste following code inside of CMakeList.txt:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"cmake_minimum_required(VERSION 2.8.3)\nproject(rosbot_patrol)\n\nadd_compile_options(-std=c++11)\n\nfind_package(catkin REQUIRED COMPONENTS\n  message_generation\n  geometry_msgs\n  gmapping\n  move_base\n  roscpp\n  rospy\n  tf\n  darknet_ros\n)\n\nfind_package( OpenCV REQUIRED )\n\n\nadd_message_files(FILES\n  EspTrigger.msg\n)\n\n\ngenerate_messages(DEPENDENCIES\n  std_msgs\n)\n\ncatkin_package(\n  CATKIN_DEPENDS\n  message_runtime\n)\n\n\ninclude_directories(\n  include ${catkin_INCLUDE_DIRS}\n  ${catkin_INCLUDE_DIRS}\n  ${OpenCV_INCLUDE_DIRS}\n)\n\n\nadd_executable(patrol_robot src/patrol_robot.cpp src/PatrolManager.cpp)\nadd_dependencies(patrol_robot ${${PROJECT_NAME}_EXPORTED_TARGETS} ${catkin_EXPORTED_TARGETS})\ntarget_link_libraries(patrol_robot\n  ${catkin_LIBRARIES} yaml-cpp\n)\n")),(0,o.kt)("p",null,"In package.xml paste:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},'<?xml version="1.0"?>\n<package format="2">\n  <name>rosbot_patrol</name>\n  <version>0.0.0</version>\n  <description>The rosbot_patrol package</description>\n\n  <maintainer email="adam-krawczyk@outlook.com">adam</maintainer>\n\n  <license>TODO</license>\n\n  <buildtool_depend>catkin</buildtool_depend>\n  <build_depend>roscpp</build_depend>\n  <build_depend>rospy</build_depend>\n  <build_export_depend>roscpp</build_export_depend>\n  <build_export_depend>rospy</build_export_depend>\n  <exec_depend>roscpp</exec_depend>\n  <exec_depend>rospy</exec_depend>\n\n\n  \x3c!-- The export tag contains other, unspecified, tags --\x3e\n  <export>\n    \x3c!-- Other tools can request additional information be placed here --\x3e\n\n  </export>\n<build_depend>message_generation</build_depend>\n<build_export_depend>message_generation</build_export_depend>\n<exec_depend>message_runtime</exec_depend>\n<build_depend> darknet_ros </build_depend>\n<build_depend>common_rosdeps</build_depend>\n<exec_depend>common_rosdeps</exec_depend>\n</package>\n')),(0,o.kt)("p",null,"Build this with ",(0,o.kt)("inlineCode",{parentName:"p"},"catkin_make install")," . After that it is possible to setup arduino IDE, to do that follow official instructions:"),(0,o.kt)("p",null,"!! Start at point 2.2 ",(0,o.kt)("a",{parentName:"p",href:"http://wiki.ros.org/rosserial_arduino/Tutorials/Arduino%20IDE%20Setup"},"setup arduino IDE")),(0,o.kt)("p",null,"If we have husarnet set up we can create new sketch for our arduino project:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"In your sketchbook create new directory called esp_husarnet"),(0,o.kt)("li",{parentName:"ol"},"In this folder create file called esp_husarnet.ino"),(0,o.kt)("li",{parentName:"ol"},"Paste following code:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c"},'#include <ros.h>\n#include <std_msgs/String.h>\n#include <WiFi.h>\n#include <Husarnet.h>\n#include <rosbot_patrol/EspTrigger.h>\n#include <WiFiMulti.h>\n\n#define PUB_FREQ 2 // frequency of publishing data - it don\'t have to be large num\n#define ID 2       // number of device - pair this with number of your room\n\nuint16_t port = 11411; //this must be set the same as tcp_port in launch file (esp_connect.launch)\n\nconst int motionSensor = 27; // pin number for motion sensor\n\n// Timer: Auxiliary variables\nunsigned long now = millis();\nunsigned long lastTrigger = 0;\n\n// Husarnet credentials\nconst char *hostName0 = "******";   //this will be the name of the 1st ESP32 device at https://app.husarnet.com\nconst char *hostName1 = "********"; //this will be the name of the host/rosmaster device at https://app.husarnet.com\n\n/* to get your join code go to https://app.husarnet.com\n-> select network\n-> click "Add element"\n-> select "join code" tab\nKeep it secret!\n*/\nconst char *husarnetJoinCode = "**********";\n\n// WiFi credentials\n#define NUM_NETWORKS 2 //number of Wi-Fi network credentials saved\n\nconst char *ssidTab[NUM_NETWORKS] = {\n    "****",\n    "***",\n};\n\nconst char *passwordTab[NUM_NETWORKS] = {\n    "******",\n    "********",\n};\n\nWiFiMulti wifiMulti;\nHusarnetClient client;\n\nclass WiFiHardware\n{\n\npublic:\n    WiFiHardware(){};\n\n    void init()\n    {\n        // do your initialization here. this probably includes TCP server/client setup\n        Serial.printf("WiFiHardware: init, hostname = %s, port = %d\\r\\n", hostName1, port);\n        while (!client.connect(hostName1, port))\n        {\n            Serial.printf("Waiting for connection\\r\\n");\n            delay(500);\n        }\n    }\n\n    // read a byte from the serial port. -1 = failure\n    int read()\n    {\n        // implement this method so that it reads a byte from the TCP connection and returns it\n        // you may return -1 is there is an error; for example if the TCP connection is not open\n        return client.read(); //will return -1 when it will works\n    }\n\n    // write data to the connection to ROS\n    void write(uint8_t *data, int length)\n    {\n        // implement this so that it takes the arguments and writes or prints them to the TCP connection\n        for (int i = 0; i < length; i++)\n        {\n            client.write(data[i]);\n        }\n    }\n\n    // returns milliseconds since start of program\n    unsigned long time()\n    {\n        return millis(); // easy; did this one for you\n    }\n};\n\nros::NodeHandle_<WiFiHardware> nh;\n\nrosbot_patrol::EspTrigger esp_msg;\n\nros::Publisher motion_trigger("motion_trigger", &esp_msg);\nvolatile bool move = 0;\n\nvoid IRAM_ATTR detectsMovement()\n{\n    Serial.println("MOTION DETECTED!!!");\n    ::move = 1;\n}\n\nvoid taskWifi(void *parameter);\n\nvoid setup()\n{\n    for (int i = 0; i < NUM_NETWORKS; i++)\n    {\n        String ssid = ssidTab[i];\n        String pass = passwordTab[i];\n        wifiMulti.addAP(ssid.c_str(), pass.c_str());\n\n        Serial.printf("WiFi %d: SSID: \\"%s\\" ; PASS: \\"%s\\"\\r\\n", i, ssid.c_str(), pass.c_str());\n    }\n\n    xTaskCreate(\n        taskWifi,   /* Task function. */\n        "taskWifi", /* String with name of task. */\n        10000,      /* Stack size in bytes. */\n        NULL,       /* Parameter passed as input of the task */\n        1,          /* Priority of the task. */\n        NULL);      /* Task handle. */\n\n    Serial.begin(115200);\n    nh.initNode();\n    nh.advertise(motion_trigger);\n\n    pinMode(motionSensor, INPUT_PULLUP);\n    attachInterrupt(digitalPinToInterrupt(motionSensor), detectsMovement, RISING);\n}\n\nvoid loop()\n{\n    now = millis();\n    if ((now - lastTrigger) > (1000 / PUB_FREQ))\n    {\n        if (client.connected())\n        {\n            Serial.println("Looking for move!!!");\n            esp_msg.move = ::move;\n            esp_msg.id = ID;\n            motion_trigger.publish(&esp_msg);\n            ::move = 0;\n            lastTrigger = millis();\n            nh.spinOnce();\n        }\n        else\n        {\n            while (!client.connect(hostName1, port))\n            {\n                Serial.printf("Waiting for connection\\r\\n");\n                delay(500);\n            }\n        }\n    }\n}\n\nvoid taskWifi(void *parameter)\n{\n    while (1)\n    {\n        uint8_t stat = wifiMulti.run();\n        if (stat == WL_CONNECTED)\n        {\n            Serial.println("");\n            Serial.println("WiFi connected");\n            Serial.println("IP address: ");\n            Serial.println(WiFi.localIP());\n\n            Husarnet.join(husarnetJoinCode, hostName0);\n            Husarnet.start();\n\n            while (WiFi.status() == WL_CONNECTED)\n            {\n                delay(500);\n            }\n        }\n        else\n        {\n            Serial.printf("WiFi error: %d\\r\\n", (int)stat);\n            delay(500);\n        }\n    }\n}\n')),(0,o.kt)("p",null,"At the end connect motion sensor to ESP32:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"motion_sensor_esp",src:a(48043).Z,width:"927",height:"900"})),(0,o.kt)("p",null,"At the end we have to create launch for esp enabling us to read data it sends, to do, so follow this instruction:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"roscd rosbot_patrol\ncd launch\ntouch esp_connector.launch\n")),(0,o.kt)("p",null,"In this file paste following launch:\nOnly what you have to take care of is to set appropriate port for each device I suggest to use 11411, 11412 and so on remember to it the same as in esp code."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},'<launch >\n\n<node pkg="rosserial_python" type="serial_node.py" name="esp_client1"  respawn="true">\n<param name="port" value="tcp"/>\n<param name="tcp_port" value="11411"/>\n</node>\n\n<node pkg="rosserial_python" type="serial_node.py" name="esp_client2"  respawn="true">\n<param name="port" value="tcp"/>\n<param name="tcp_port" value="11412"/>\n</node>\n\n<node pkg="rosserial_python" type="serial_node.py" name="esp_client3"  respawn="true">\n<param name="port" value="tcp"/>\n<param name="tcp_port" value="11413"/>\n</node>\n\n</launch>\n')),(0,o.kt)("p",null,"If you need more clients just add it if less you should remove unused or comment it."),(0,o.kt)("h2",{id:"darknet-yolo"},"Darknet YOLO"),(0,o.kt)("p",null,"We only will be launching image processing on computer but if you want to clone whole repository to your robot you can so don't be afraid of that."),(0,o.kt)("p",null,"I'm assuming that you already have in your workspace darknet_ros package next thing is to create our config file and launch file for darknet:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"roscd rosbot patrol\ncd launch\ntouch darknet_yolo_only.launch\n")),(0,o.kt)("p",null,"In this file paste following code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},'<launch>\n\n  \x3c!-- Console launch prefix --\x3e\n  <arg name="launch_prefix" default=""/>\n\n  \x3c!-- Config and weights folder --\x3e\n  <arg name="yolo_weights_path"          default="$(find darknet_ros)/yolo_network_config/weights"/>\n  <arg name="yolo_config_path"           default="$(find darknet_ros)/yolo_network_config/cfg"/>\n\n  \x3c!-- ROS and network parameter files --\x3e\n  <arg name="ros_param_file"             default="$(find rosbot_patrol)/config/darknet_config.yaml"/>\n  <arg name="network_param_file"         default="$(find darknet_ros)/config/yolov2-tiny.yaml"/>\n\n  \x3c!-- Load parameters --\x3e\n  <rosparam command="load" ns="darknet_ros" file="$(arg ros_param_file)"/>\n  <rosparam command="load" ns="darknet_ros" file="$(arg network_param_file)"/>\n\n  \x3c!-- Start darknet and ros wrapper --\x3e\n  <node pkg="darknet_ros" type="darknet_ros" name="darknet_ros" output="screen" launch-prefix="$(arg launch_prefix)">\n    <param name="weights_path"          value="$(arg yolo_weights_path)" />\n    <param name="config_path"           value="$(arg yolo_config_path)" />\n  </node>\n\n</launch>\n')),(0,o.kt)("p",null,"Next we need to setup our neural network - for that we will use pre-trained model. In config directory we create for this purpose config file."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"roscd rosbot_patrol\nmkdir config\ncd config\ntouch darknet_config.yaml\n")),(0,o.kt)("p",null,"In darknet_config.yaml:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"subscribers:\n\n  camera_reading:\n    topic: /rgb_raw\n    queue_size: 1\n\nactions:\n\n  camera_reading:\n    name: /darknet_ros/check_for_objects\n\npublishers:\n\n  object_detector:\n    topic: /darknet_ros/found_object\n    queue_size: 1\n    latch: false\n\n  bounding_boxes:\n    topic: /darknet_ros/bounding_boxes\n    queue_size: 1\n    latch: false\n\n  detection_image:\n    topic: /darknet_ros/detection_image\n    queue_size: 1\n    latch: true\n\nimage_view:\n\n  enable_opencv: true\n  wait_key_delay: 1\n  enable_console_output: true\n")),(0,o.kt)("p",null,"And that's all - there is no need to change anything else, now create launch file for our network. In launch directory create new file called darknet_yolo_simulation_only.launch"),(0,o.kt)("h2",{id:"final-launch-files"},"Final launch files"),(0,o.kt)("p",null,"So if the map is in our workspace and every algorithm configured we now can start our robot to move on map. It's almost end don't give up :)"),(0,o.kt)("p",null,"In launch file create files rosbot_patrol.launch and rosbot_patrol_pc.launch"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-BASH"},"roscd rosbot_patrol\ncd launch\ntouch rosbot_patrol.launch\ntouch rosbot_patrol_pc.launch\n")),(0,o.kt)("p",null,"First launch will be running on rosbot but second is made for pc this is because rosbot has not enough power to process image."),(0,o.kt)("p",null,"In rosbot_patrol.launch paste this code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},'<?xml version="1.0" encoding="UTF-8"?>\n<launch>\n                                \x3c!-- Image compression --\x3e\n    <node pkg="image_transport" type="republish" name="rgb_compress" args="raw in:=/camera/rgb/image_raw compressed out:=/rgb_republish">\n        <param name="compressed/mode" value="color"/>\n    </node>\n\n    <include file="$(find rosbot_patrol)/launch/rosbot_all_hardware.launch"/>\n    <include file="$(find rosbot_patrol)/launch/rosbot_all_algorithms.launch"/> \n    \n    <arg name="map_file" default="$(find rosbot_patrol)/maps/rosbot_map.yaml"/>       \x3c!-- map arg --\x3e\n    <node name="map_server" pkg="map_server" type="map_server" args="$(arg map_file)" respawn="true" />\n\n  \x3c!-- patrol node --\x3e\n<node pkg="rosbot_patrol" type="patrol_robot" name="patrolling_node" output="screen" respawn="true">\n        \x3c!-- path to file  with  params of points --\x3e \n<param name="path_to_params" type="string" value="$(find rosbot_patrol)/params/room_points.yaml" />\n<param name="email_to" type="string" value="*****@**.**" />\n<param name="email_from" type="string" value="*****@****.***" /> \n</node>\n\n\n</launch>\n')),(0,o.kt)("p",null,"File rosbot_patrol_pc.launch is made for being launched form your personal computer this is because of the fact that current version of rosbot don't have enough compute power to handle CNN (convolutional neural network) - you can paste this file to simulation pkg also and run this with appropriate launch command, paste this code to launch file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},'<?xml version="1.0" encoding="UTF-8"?>\n<launch>\n\n    <arg name="use_esp" default="true"/>\n\n    <node pkg="image_transport" type="republish" name="rgb_decompress" args=" compressed in:=/rgb_republish raw out:=/rgb_raw" respawn="true">\n        <param name="compressed/mode" value="color"/>\n    </node>\n\n    <include file="$(find rosbot_patrol)/launch/darknet_yolo_only.launch"/>\n\n     <include if="$(arg use_esp)" file="$(find rosbot_patrol)/launch/esp_connector.launch"/>\n     \n</launch>\n')),(0,o.kt)("h3",{id:"complete-code"},"Complete code"),(0,o.kt)("p",null,"a) simulation ",(0,o.kt)("inlineCode",{parentName:"p"},"git clone https://github.com/adamkrawczyk/rosbot_patrol_simulation.git")),(0,o.kt)("p",null,"b) real_robot ",(0,o.kt)("inlineCode",{parentName:"p"},"git clone https://github.com/adamkrawczyk/rosbot_patrol.git")),(0,o.kt)("h2",{id:"finishing"},"Finishing"),(0,o.kt)("p",null,"To launch this I advise you to have the same code in robot and on your computer."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Add every device to husarnet to the same network"),(0,o.kt)("li",{parentName:"ol"},"Set rosmaster to robot - less latency"),(0,o.kt)("li",{parentName:"ol"},"Launch robot using ",(0,o.kt)("inlineCode",{parentName:"li"},"roslaunch rosbot_patrol rosbot_patrol.launch")),(0,o.kt)("li",{parentName:"ol"},"On computer launch file ",(0,o.kt)("inlineCode",{parentName:"li"},"roslaunch rosbot_patrol rosbot_patrol_pc.launch"))),(0,o.kt)("p",null,"On your computer you should see window with bounding boxes around things that our neural network recognized."),(0,o.kt)("p",null,"If one of your sensor detect movement robot will go to point assigned to this sensor and look for people, once it detects you should receive mail."),(0,o.kt)("p",null,"In case you have no motion sensor just publish to the topic robot is listening for move ",(0,o.kt)("inlineCode",{parentName:"p"},'rostopic pub /motion_trigger simulation/EspTrigger "id: 1 move: 1"')," with appropriate id number."),(0,o.kt)("p",null,"At the end you should see on your computer something similar to this:"),(0,o.kt)("h2",{id:"rosbot_final_result"},(0,o.kt)("img",{alt:"rosbot_final_result",src:a(3689).Z,width:"1565",height:"696"})),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"by Adam Krawczyk, Husarion")),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"Do you need any support with completing this project or have any difficulties with software or hardware? Feel free to describe your thoughts on our community forum: ",(0,o.kt)("a",{parentName:"em",href:"https://community.husarion.com/"},"https://community.husarion.com/")," or to contact with our support: ",(0,o.kt)("a",{parentName:"em",href:"mailto:support@husarion.com"},"support@husarion.com"))))}h.isMDXComponent=!0},10777:(e,n,a)=>{a.d(n,{Z:()=>t});const t=a.p+"assets/images/Run-on-ROSDS-button-b9e5fc7d51adff3c681aa33ea58e6ebc.png"},51879:(e,n,a)=>{a.d(n,{Z:()=>t});const t=a.p+"assets/images/how-it-works-e2d2b89b9c77471968d5fa4dc6288670.png"},61042:(e,n,a)=>{a.d(n,{Z:()=>t});const t=a.p+"assets/images/how-to-get-points-82e65bb11000b95e23e393c56939dec0.png"},48043:(e,n,a)=>{a.d(n,{Z:()=>t});const t=a.p+"assets/images/motion-sensor-esp-727bba7aaac9c4a63f09adf73d71fd63.png"},3689:(e,n,a)=>{a.d(n,{Z:()=>t});const t=a.p+"assets/images/rosbot-final-result-e8beea48999941f14e4369453b48cb00.png"},40936:(e,n,a)=>{a.d(n,{Z:()=>t});const t=a.p+"assets/images/rosbot-patrol-final-9fa8f3dce286b2e646faba670d30c123.png"},81394:(e,n,a)=>{a.d(n,{Z:()=>t});const t=a.p+"assets/images/rosbot-room-plan-d5b540ff2aa934a38584d3b0b0218abf.png"}}]);
]3      d|/d|0EQd\   ^    O^partitionKey=%28https%2Chusarion.com%29,:https://husarion.com/assets/js/ac9d5181.709beef1.js necko:classified 1 strongly-framed 1 security-info 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 request-method GET response-head HTTP/1.1 200 OK
Server: nginx/1.18.0 (Ubuntu)
Date: Thu, 08 Jun 2023 06:58:55 GMT
Content-Type: application/javascript
Content-Length: 88012
Last-Modified: Thu, 01 Jun 2023 15:27:47 GMT
ETag: "6478b8f3-157cc"
Accept-Ranges: bytes
 original-response-headers Server: nginx/1.18.0 (Ubuntu)
Date: Thu, 08 Jun 2023 06:58:55 GMT
Content-Type: application/javascript
Content-Length: 88012
Last-Modified: Thu, 01 Jun 2023 15:27:47 GMT
Connection: keep-alive
ETag: "6478b8f3-157cc"
Accept-Ranges: bytes
 ctid 2 uncompressed-len 0 net-response-time-onstart 578 net-response-time-onstop 925  W